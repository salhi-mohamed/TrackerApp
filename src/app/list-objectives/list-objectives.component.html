<app-navbar></app-navbar>

<div class="flex flex-col min-h-screen bg-gray-100">
  <div class="container mx-auto flex-grow py-8 px-4 sm:px-6 lg:px-8">
    <div class="title-container text-center mb-8 bg-white bg-opacity-80 p-6 rounded-lg shadow-lg title-offset">
      <h2 class="text-3xl font-bold text-gray-800">
        <i class="fas fa-list mr-2"></i>Liste des Objectifs
      </h2>
    </div>
    <div class="flex flex-wrap -mx-4">
      <div *ngFor="let objective of objectives" class="w-full md:w-1/2 lg:w-1/3 px-4 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-lg transition transform hover:scale-105" *ngIf="!isEditing || objectiveBeingEdited?.id !== objective.id">
          <div class="bg-purple-600 text-white text-xl font-semibold p-4 rounded-t-lg">
            {{ objective.title }}
          </div>
          <div class="p-4">
            <div class="flex justify-between items-center mb-4">
              <div></div>
              <div class="flex space-x-2">
                <button class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 focus:outline-none" (click)="editObjective(objective)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none" (click)="deleteObj(objective)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <p class="text-gray-700 mb-1"><strong>Description:</strong> {{ objective.description }}</p>
            <p class="text-gray-700 mb-1"><strong>Catégorie:</strong> {{ objective.category }}</p>
            <p class="text-gray-700 mb-1"><strong>Priorité:</strong> {{ objective.priority }}</p>
            <p class="text-gray-700 mb-1"><strong>Statut:</strong> {{ objective.status }}</p>
            <p class="text-gray-700 mb-1"><strong>Début:</strong> {{ objective.startDate | date }}</p>
            <p class="text-gray-700 mb-1"><strong>Fin:</strong> {{ objective.endDate | date }}</p>
            <p class="text-gray-700 mb-1"><strong>Tags:</strong> {{ objective.tags }}</p>
            <p *ngIf="objective.attachment" class="text-gray-700 mb-1"><strong>Pièce Jointe:</strong> {{ objective.attachment?.name }}</p>
            <p *ngIf="objective.reminder" class="text-gray-700 mb-1"><strong>Rappel:</strong> {{ objective.reminder }}</p>
            <p class="text-gray-700"><strong>Confidentialité:</strong> {{ objective.privacy }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
              <div class="bg-blue-600 h-2.5 rounded-full" [style.width]="objective.progress + '%'"></div>
            </div>
            <p class="text-gray-600 text-sm mt-1 text-right">{{ objective.progress }}%</p>
            <button class="bg-blue-500 text-white px-4 py-2 rounded mt-4 hover:bg-blue-600 focus:outline-none w-full" (click)="viewGoalDetails(objective.id)">
              Voir les détails
            </button>
          </div>
        </div>

        <!-- Formulaire d'édition -->
        <div class="bg-white p-6 rounded-lg shadow-lg" *ngIf="isEditing && objectiveBeingEdited && objectiveBeingEdited.id === objective.id">
          <div class="bg-purple-600 text-white text-xl font-semibold p-4 rounded-t-lg">
            <input [(ngModel)]="objectiveBeingEdited.title" class="bg-purple-600 text-white w-full text-xl font-semibold rounded-t-lg p-2" />
          </div>
          <div class="p-4">
            <div class="flex justify-between items-center mb-4">
              <div></div>
              <div class="flex space-x-2">
                <button class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 focus:outline-none" (click)="saveObjective()">
                  <i class="fas fa-save"></i>
                </button>
                <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none" (click)="cancelEdit()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <label class="block mb-2 text-gray-700 font-bold">Description</label>
            <textarea [(ngModel)]="objectiveBeingEdited.description" class="w-full p-2 mb-4 border border-gray-300 rounded"></textarea>
            <label class="block mb-2 text-gray-700 font-bold">Catégorie</label>
            <select [(ngModel)]="objectiveBeingEdited.category" class="w-full p-2 mb-4 border border-gray-300 rounded">
              <option value="Professionnel">Professionnel</option>
              <option value="Personnel">Personnel</option>
              <option value="Santé">Santé</option>
              <option value="Autre">Autre</option>
            </select>
            <label class="block mb-2 text-gray-700 font-bold">Priorité</label>
            <select [(ngModel)]="objectiveBeingEdited.priority" class="w-full p-2 mb-4 border border-gray-300 rounded">
              <option value="Haute">Haute</option>
              <option value="Moyenne">Moyenne</option>
              <option value="Basse">Basse</option>
            </select>
            <label class="block mb-2 text-gray-700 font-bold">Statut</label>
            <select [(ngModel)]="objectiveBeingEdited.status" class="w-full p-2 mb-4 border border-gray-300 rounded">
              <option value="En cours">En cours</option>
              <option value="Complété">Complété</option>
              <option value="En attente">En attente</option>
            </select>
            <label class="block mb-2 text-gray-700 font-bold">Début</label>
            <input type="date" [(ngModel)]="objectiveBeingEdited.startDate" class="w-full p-2 mb-4 border border-gray-300 rounded" />
            <label class="block mb-2 text-gray-700 font-bold">Fin</label>
            <input type="date" [(ngModel)]="objectiveBeingEdited.endDate" class="w-full p-2 mb-4 border border-gray-300 rounded" />
            <label class="block mb-2 text-gray-700 font-bold">Tags</label>
            <input type="text" [(ngModel)]="objectiveBeingEdited.tags" class="w-full p-2 mb-4 border border-gray-300 rounded" />
            <label class="block mb-2 text-gray-700 font-bold">Rappel</label>
            <input type="datetime-local" [(ngModel)]="objectiveBeingEdited.reminder" class="w-full p-2 mb-4 border border-gray-300 rounded" *ngIf="objectiveBeingEdited.reminderEnabled" />
            <div class="flex items-center">
              <input type="checkbox" [(ngModel)]="objectiveBeingEdited.reminderEnabled" class="mr-2" />
              <label>Activer les rappels</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer class="app-footer"></app-footer>

<app-confirm-dialog *ngIf="showDialog" [data]="objectiveToDelete" (close)="confirmDelete($event)"></app-confirm-dialog>
