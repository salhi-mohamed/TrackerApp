<app-navbar></app-navbar>

<div class="flex flex-col min-h-screen bg-gray-100">
  <div class="container mx-auto flex-grow py-8 px-4 sm:px-6 lg:px-8">
    <div class="title-container text-center mb-8 bg-white bg-opacity-80 p-6 rounded-lg shadow-lg title-offset">
      <h2 class="text-3xl font-bold text-gray-800">
        <i class="fas fa-list mr-2"></i>Liste des Tâches
      </h2>
    </div>
    <div class="flex flex-wrap -mx-4">
      <div *ngFor="let task of tasks" class="w-full md:w-1/2 lg:w-1/3 px-4 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-lg transition transform hover:scale-105" *ngIf="!isEditing || taskBeingEdited?._id !== task._id">
          <div class="bg-purple-600 text-white text-xl font-semibold p-4 rounded-t-lg">
            {{ task.title }}
          </div>
          <div class="p-4">
            <div class="flex justify-between items-center mb-4">
              <div></div>
              <div class="flex space-x-2">
                <button class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 focus:outline-none" (click)="editTask(task)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none" (click)="deleteTask(task)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
            <p class="text-gray-700 mb-1"><strong>Description:</strong> {{ task.description }}</p>
            <p class="text-gray-700 mb-1"><strong>Date d'Échéance:</strong> {{ task.dueDate | date }}</p>
            <p class="text-gray-700 mb-1"><strong>Priorité:</strong> {{ task.priority }}</p>
            <p class="text-gray-700 mb-1"><strong>Statut:</strong> {{ task.status }}</p>
            <p class="text-gray-700 mb-1"><strong>Tags:</strong> {{ task.tags }}</p>
            <p *ngIf="task.reminder" class="text-gray-700 mb-1"><strong>Rappel:</strong> {{ task.reminder }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2.5 mt-4">
              <div class="bg-blue-600 h-2.5 rounded-full" [style.width]="calculateProgress(task) + '%'"></div>
            </div>
            <p class="text-gray-600 text-sm mt-1 text-right">{{ calculateProgress(task) }}%</p>
            <button class="bg-blue-500 text-white px-4 py-2 rounded mt-4 hover:bg-blue-600 focus:outline-none w-full" (click)="viewTaskDetails(task._id)">
              Voir les détails
            </button>
          </div>
        </div>

        <!-- Formulaire d'édition -->
        <div class="bg-white p-6 rounded-lg shadow-lg" *ngIf="isEditing && taskBeingEdited && taskBeingEdited._id === task._id">
          <div class="bg-purple-600 text-white text-xl font-semibold p-4 rounded-t-lg">
            <input [(ngModel)]="taskBeingEdited.title" class="bg-purple-600 text-white w-full text-xl font-semibold rounded-t-lg p-2" />
          </div>
          <div class="p-4">
            <div class="flex justify-between items-center mb-4">
              <div></div>
              <div class="flex space-x-2">
                <button class="bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 focus:outline-none" (click)="saveTask()">
                  <i class="fas fa-save"></i>
                </button>
                <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 focus:outline-none" (click)="cancelEdit()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            <label class="block mb-2 text-gray-700 font-bold">Description</label>
            <textarea [(ngModel)]="taskBeingEdited.description" class="w-full p-2 mb-4 border border-gray-300 rounded"></textarea>
            <label class="block mb-2 text-gray-700 font-bold">Date d'Échéance</label>
            <input type="date" [(ngModel)]="taskBeingEdited.dueDate" class="w-full p-2 mb-4 border border-gray-300 rounded" />
            <label class="block mb-2 text-gray-700 font-bold">Priorité</label>
            <select [(ngModel)]="taskBeingEdited.priority" class="w-full p-2 mb-4 border border-gray-300 rounded">
              <option value="Haute">Haute</option>
              <option value="Moyenne">Moyenne</option>
              <option value="Basse">Basse</option>
            </select>
            <label class="block mb-2 text-gray-700 font-bold">Statut</label>
            <select [(ngModel)]="taskBeingEdited.status" class="w-full p-2 mb-4 border border-gray-300 rounded">
              <option value="En cours">En cours</option>
              <option value="Complété">Complété</option>
              <option value="En attente">En attente</option>
            </select>
            <label class="block mb-2 text-gray-700 font-bold">Tags</label>
            <input type="text" [(ngModel)]="taskBeingEdited.tags" class="w-full p-2 mb-4 border border-gray-300 rounded" />
            <label class="block mb-2 text-gray-700 font-bold">Rappel</label>
            <input type="datetime-local" [(ngModel)]="taskBeingEdited.reminder" class="w-full p-2 mb-4 border border-gray-300 rounded" *ngIf="taskBeingEdited.reminderEnabled" />
            <div class="flex items-center">
              <input type="checkbox" [(ngModel)]="taskBeingEdited.reminderEnabled" class="mr-2" />
              <label>Activer les rappels</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <app-footer class="app-footer"></app-footer>
</div>

<app-confirm-dialog *ngIf="showDialog" [data]="taskToDelete" (close)="confirmDelete($event)"></app-confirm-dialog>
